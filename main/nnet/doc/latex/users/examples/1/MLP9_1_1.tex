\noindent
\ttfamily
\hlstd{}\hlline{00001\ }\hlslc{\#\# Copyright (C) 2006 Michel D. Schmid}\\
\hlline{00002\ }\hlstd{}\hlslc{\#\#}\\
\hlline{00003\ }\hlstd{}\hlslc{\#\# This file is part of octnnettb.}\\
\hlline{00004\ }\hlstd{}\hlslc{\#\#}\\
\hlline{00005\ }\hlstd{}\hlslc{\#\# octnnettb is free software; you can redistribute it and/or modify it}\\
\hlline{00006\ }\hlstd{}\hlslc{\#\# under the terms of the GNU General Public License as published by}\\
\hlline{00007\ }\hlstd{}\hlslc{\#\# the Free Software Foundation; either version 2, or (at your option)}\\
\hlline{00008\ }\hlstd{}\hlslc{\#\# any later version.}\\
\hlline{00009\ }\hlstd{}\hlslc{\#\#}\\
\hlline{00010\ }\hlstd{}\hlslc{\#\# octnnettb is distributed in the hope that it will be useful, but}\\
\hlline{00011\ }\hlstd{}\hlslc{\#\# WITHOUT ANY WARRANTY; without even the implied warranty of}\\
\hlline{00012\ }\hlstd{}\hlslc{\#\# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.}\hlstd{\ \ }\hlslc{See the GNU}\\
\hlline{00013\ }\hlstd{}\hlslc{\#\# General Public License for more details.}\\
\hlline{00014\ }\hlstd{}\hlslc{\#\#}\\
\hlline{00015\ }\hlstd{}\hlslc{\#\# You should have received a copy of the GNU General Public License}\\
\hlline{00016\ }\hlstd{}\hlslc{\#\# along with octnnettb; see the file COPYING.}\hlstd{\ \ }\hlslc{If not, write to the Free}\\
\hlline{00017\ }\hlstd{}\hlslc{\#\# Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}\\
\hlline{00018\ }\hlstd{}\hlslc{\#\# 02110{-}1301, USA.}\\
\hlline{00019\ }\hlstd{}\\
\hlline{00020\ }\hlslc{\#\# This is a test to train a 9{-}1{-}1 MLP (was a real project).}\\
\hlline{00021\ }\hlstd{}\\
\hlline{00022\ }\hlslc{\#\# author: msd}\\
\hlline{00023\ }\hlstd{}\hlslc{\#\# e{-}mail: michaelschmid@users.sourceforge.net}\\
\hlline{00024\ }\hlstd{}\\
\hlline{00025\ }\\
\hlline{00026\ }\hlslc{\#\# for debug purpose only}\\
\hlline{00027\ }\hlstd{}\hlkwa{global }\hlstd{DEBUG }\hlsym{= }\hlstd{}\hlnum{0}\hlstd{}\hlsym{;}\\
\hlline{00028\ }\hlstd{}\hlslc{\#\# comments to DEBUG:}\\
\hlline{00029\ }\hlstd{}\hlslc{\# 0 or not exist means NO DEBUG}\\
\hlline{00030\ }\hlstd{}\hlslc{\# 1 means, DEBUG, write to command window}\\
\hlline{00031\ }\hlstd{}\hlslc{\# 2 means, DEBUG, write to files...}\\
\hlline{00032\ }\hlstd{}\\
\hlline{00033\ }\\
\hlline{00034\ }\hlslc{\#\# load data}\\
\hlline{00035\ }\hlstd{\\
\hlline{00036\ }mData }\hlsym{= }\hlstd{}\hlkwa{load}\hlstd{}\hlsym{(}\hlstd{}\hlstr{"mData.txt"}\hlstd{}\hlsym{,}\hlstd{}\hlstr{"mData"}\hlstd{}\hlsym{);}\\
\hlline{00037\ }\hlstd{mData }\hlsym{= }\hlstd{mData.mData}\hlsym{;}\\
\hlline{00038\ }\hlstd{}\hlsym{{[}}\hlstd{nRows}\hlsym{, }\hlstd{nColumns}\hlsym{{]} = }\hlstd{}\hlkwa{size}\hlstd{}\hlsym{(}\hlstd{mData}\hlsym{);}\\
\hlline{00039\ }\hlstd{}\hlslc{\# this file contains 13 columns. The first 12 columns are the inputs}\\
\hlline{00040\ }\hlstd{}\hlslc{\# the last column is the output}\\
\hlline{00041\ }\hlstd{}\hlslc{\# remove column 4, 8 and 12}\\
\hlline{00042\ }\hlstd{}\hlslc{\# 89 rows}\\
\hlline{00043\ }\hlstd{}\\
\hlline{00044\ }\hlslc{\#\# first permute the whole matrix in row wise}\\
\hlline{00045\ }\hlstd{}\hlslc{\#\# this won't be used right now for debug and test purpose}\\
\hlline{00046\ }\hlstd{}\hlslc{\# order = randperm(nRows);}\\
\hlline{00047\ }\hlstd{}\hlslc{\# mData(order,:) = mData;}\\
\hlline{00048\ }\hlstd{\\
\hlline{00049\ }mOutput }\hlsym{= }\hlstd{mData}\hlsym{(:,}\hlstd{}\hlkwa{end}\hlstd{}\hlsym{);}\\
\hlline{00050\ }\hlstd{mInput }\hlsym{= }\hlstd{mData}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{}\hlkwa{end}\hlstd{}\hlsym{{-}}\hlstd{}\hlnum{1}\hlstd{}\hlsym{);}\\
\hlline{00051\ }\hlstd{mInput}\hlsym{(:,{[}}\hlstd{}\hlnum{4 8 12}\hlstd{}\hlsym{{]}) = {[}{]}; }\hlstd{}\hlslc{\# delete column 4, 8 and 12}\\
\hlline{00052\ }\hlstd{}\\
\hlline{00053\ }\hlslc{\#\# now prepare data}\\
\hlline{00054\ }\hlstd{mInput }\hlsym{= }\hlstd{mInput'}\hlsym{;}\\
\hlline{00055\ }\hlstd{mOutput }\hlsym{= }\hlstd{mOutput'}\hlsym{;}\\
\hlline{00056\ }\hlstd{}\\%\hlsym{\%}\hlstd{mOutput }\hlsym{= {[}}\hlstd{mOutput}\hlsym{; }\hlstd{mOutput}\hlsym{{*}}\hlstd{}\hlnum{4}\hlstd{}\hlsym{{]};}\\
\hlline{00057\ }\hlstd{}\hlslc{\# now split the data matrix in 3 pieces, train data, test data and validate}\\
\hlline{00058\ }\hlslc{data}\\
\hlline{00059\ }\hlslc{\# the proportion should be about 1/2 train, 1/3 test and 1/6 validate data}\\
\hlline{00060\ }\hlstd{}\hlslc{\# in this neural network we have 12 weights, for each weight at least 3}\\
\hlline{00061\ }\hlslc{train sets..}\\
\hlline{00062\ }\hlslc{\# (that's a rule of thumb like 1/2, 1/3 and 1/6)}\\
\hlline{00063\ }\hlstd{}\hlslc{\# 1/2 of 89 = 44.5; let's take 44 for training}\\
\hlline{00064\ }\hlstd{nTrainSets }\hlsym{= }\hlstd{}\hlkwa{floor}\hlstd{}\hlsym{(}\hlstd{nRows}\hlsym{/}\hlstd{}\hlnum{2}\hlstd{}\hlsym{);}\\
\hlline{00065\ }\hlstd{}\hlslc{\# now the rest of the sets are again 100\%}\\
\hlline{00066\ }\hlstd{}\hlslc{\# ==$>$ 2/3 for test sets and 1/3 for validate sets}\\
\hlline{00067\ }\hlstd{nTestSets }\hlsym{= (}\hlstd{nRows}\hlsym{{-}}\hlstd{nTrainSets}\hlsym{)/}\hlstd{}\hlnum{3}\hlstd{}\hlsym{{*}}\hlstd{}\hlnum{2}\hlstd{}\hlsym{;}\\
\hlline{00068\ }\hlstd{nValiSets }\hlsym{= }\hlstd{nRows}\hlsym{{-}}\hlstd{nTrainSets}\hlsym{{-}}\hlstd{nTestSets}\hlsym{;}\\
\hlline{00069\ }\hlstd{\\
\hlline{00070\ }mValiInput }\hlsym{= }\hlstd{mInput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nValiSets}\hlsym{);}\\
\hlline{00071\ }\hlstd{mValliOutput }\hlsym{= }\hlstd{mOutput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nValiSets}\hlsym{);}\\
\hlline{00072\ }\hlstd{mInput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nValiSets}\hlsym{) = {[}{]};}\\
\hlline{00073\ }\hlstd{mOutput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nValiSets}\hlsym{) = {[}{]};}\\
\hlline{00074\ }\hlstd{mTestInput }\hlsym{= }\hlstd{mInput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTestSets}\hlsym{);}\\
\hlline{00075\ }\hlstd{mTestOutput }\hlsym{= }\hlstd{mOutput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTestSets}\hlsym{);}\\
\hlline{00076\ }\hlstd{mInput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTestSets}\hlsym{) = {[}{]};}\\
\hlline{00077\ }\hlstd{mOutput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTestSets}\hlsym{) = {[}{]};}\\
\hlline{00078\ }\hlstd{mTrainInput }\hlsym{= }\hlstd{mInput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTrainSets}\hlsym{);}\\
\hlline{00079\ }\hlstd{mTrainOutput }\hlsym{= }\hlstd{mOutput}\hlsym{(:,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{:}\hlstd{nTrainSets}\hlsym{);}\\
\hlline{00080\ }\hlstd{}\\
\hlline{00081\ }\hlsym{{[}}\hlstd{mTrainInputN}\hlsym{,}\hlstd{cMeanInput}\hlsym{,}\hlstd{cStdInput}\hlsym{{]} = }\hlstd{}\hlkwa{prestd}\hlstd{}\hlsym{(}\hlstd{mTrainInput}\hlsym{);}\hlstd{}\hlslc{\# standardize}\\
\hlline{00082\ }\hlstd{}\hlstd{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\hlstd{inputs}\\
\hlline{00083\ }\\
\hlline{00084\ }\hlslc{\#\# comments: there is no reason to standardize the outputs because we have}\\
\hlline{00085\ }\hlslc{only}\\
\hlline{00086\ }\hlslc{\# one output ...}\\
\hlline{00087\ }\hlstd{}\\
\hlline{00088\ }\hlslc{\# define the max and min inputs for each row}\\
\hlline{00089\ }\hlstd{mMinMaxElements }\hlsym{= }\hlstd{}\hlkwa{min\textunderscore max}\hlstd{}\hlsym{(}\hlstd{mTrainInputN}\hlsym{); \% }\hlstd{input matrix with }\hlsym{(}\hlstd{R x }\hlnum{2}\hlstd{}\hlsym{)}\hlstd{...}\\
\hlline{00090\ }\\
\hlline{00091\ }\hlslc{\#\# define network}\\
\hlline{00092\ }\hlstd{nHiddenNeurons }\hlsym{= }\hlstd{}\hlnum{1}\hlstd{}\hlsym{;}\\
\hlline{00093\ }\hlstd{nOutputNeurons }\hlsym{= }\hlstd{}\hlnum{1}\hlstd{}\hlsym{;}\\
\hlline{00094\ }\hlstd{\\
\hlline{00095\ }MLPnet }\hlsym{= }\hlstd{}\hlkwa{newff}\hlstd{}\hlsym{(}\hlstd{mMinMaxElements}\hlsym{,{[}}\hlstd{nHiddenNeurons nOutputNeurons}\hlsym{{]},\{}\hlstd{}\hlstr{"tansig"}\hlstd{}\hlsym{,}\\
\hlline{00096\ }\hlstd{}\hlstd{\ \ \ \ \ \ \ \ \ }\hlstd{}\hlstr{"purelin"}\hlstd{}\hlsym{\},}\hlstd{}\hlstr{"trainlm"}\hlstd{}\hlsym{,}\hlstd{}\hlstr{"learngdm"}\hlstd{}\hlsym{,}\hlstd{}\hlstr{"mse"}\hlstd{}\hlsym{);}\\
\hlline{00097\ }\hlstd{}\hlslc{\#\# for test purpose, define weights by hand}\\
\hlline{00098\ }\hlstd{MLPnet.IW}\hlsym{\{}\hlstd{}\hlnum{1}\hlstd{}\hlsym{,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{\}(:) = }\hlstd{}\hlnum{1.5}\hlstd{}\hlsym{;}\\
\hlline{00099\ }\hlstd{MLPnet.LW}\hlsym{\{}\hlstd{}\hlnum{2}\hlstd{}\hlsym{,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{\}(:) = }\hlstd{}\hlnum{0.5}\hlstd{}\hlsym{;}\\
\hlline{00100\ }\hlstd{MLPnet.b}\hlsym{\{}\hlstd{}\hlnum{1}\hlstd{}\hlsym{,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{\}(:) = }\hlstd{}\hlnum{1.5}\hlstd{}\hlsym{;}\\
\hlline{00101\ }\hlstd{MLPnet.b}\hlsym{\{}\hlstd{}\hlnum{2}\hlstd{}\hlsym{,}\hlstd{}\hlnum{1}\hlstd{}\hlsym{\}(:) = }\hlstd{}\hlnum{0.5}\hlstd{}\hlsym{;}\\
\hlline{00102\ }\hlstd{}\\
\hlline{00103\ }\hlkwa{saveMLPStruct}\hlstd{}\hlsym{(}\hlstd{MLPnet}\hlsym{,}\hlstd{}\hlstr{"MLP3test.txt"}\hlstd{}\hlsym{);}\\
\hlline{00104\ }\hlstd{}\hlslc{\#disp("network structure saved, press any key to continue...")}\\
\hlline{00105\ }\hlstd{}\hlslc{\#pause}\\
\hlline{00106\ }\hlstd{}\\
\hlline{00107\ }\hlslc{\#\# define validation data new, for matlab compatibility}\\
\hlline{00108\ }\hlstd{VV.P }\hlsym{= }\hlstd{mValiInput}\hlsym{;}\\
\hlline{00109\ }\hlstd{VV.T }\hlsym{= }\hlstd{mValliOutput}\hlsym{;}\\
\hlline{00110\ }\hlstd{}\\
\hlline{00111\ }\hlslc{\#\# standardize also the validate data}\\
\hlline{00112\ }\hlstd{VV.P }\hlsym{= }\hlstd{}\hlkwa{trastd}\hlstd{}\hlsym{(}\hlstd{VV.P}\hlsym{,}\hlstd{cMeanInput}\hlsym{,}\hlstd{cStdInput}\hlsym{);}\\
\hlline{00113\ }\hlstd{}\\
\hlline{00114\ }\hlslc{\#{[}net,tr,out,E{]} = train(MLPnet,mInputN,mOutput,{[}{]},{[}{]},VV);}\\
\hlline{00115\ }\hlstd{}\hlsym{{[}}\hlstd{net}\hlsym{{]} = }\hlstd{}\hlkwa{train}\hlstd{}\hlsym{(}\hlstd{MLPnet}\hlsym{,}\hlstd{mTrainInputN}\hlsym{,}\hlstd{mTrainOutput}\hlsym{,{[}{]},{[}{]},}\hlstd{VV}\hlsym{);}\\
\hlline{00116\ }\hlstd{}\hlslc{\# saveMLPStruct(net,"MLP3testNachTraining.txt");}\\
\hlline{00117\ }\hlstd{}\hlslc{\# disp("network structure saved, press any key to continue...")}\\
\hlline{00118\ }\hlstd{}\hlslc{\# pause}\\
\hlline{00119\ }\hlstd{}\\
\hlline{00120\ }\hlslc{\# \% make preparations for net test and test MLPnet}\\
\hlline{00121\ }\hlstd{}\hlslc{\#}\hlstd{\ \ \ \ \ }\hlslc{\% standardise input \& output test data}\\
\hlline{00122\ }\hlstd{}\hlsym{{[}}\hlstd{mTestInputN}\hlsym{{]} = }\hlstd{}\hlkwa{trastd}\hlstd{}\hlsym{(}\hlstd{mTestInput}\hlsym{,}\hlstd{cMeanInput}\hlsym{,}\hlstd{cStdInput}\hlsym{);}\\
\hlline{00123\ }\hlstd{}\\
\hlline{00124\ }\hlsym{{[}}\hlstd{simOut}\hlsym{{]} = }\hlstd{}\hlkwa{sim}\hlstd{}\hlsym{(}\hlstd{net}\hlsym{,}\hlstd{mTestInputN}\hlsym{);\%,}\hlstd{Pi}\hlsym{,}\hlstd{Ai}\hlsym{,}\hlstd{mTestOutput}\hlsym{);}\\
\hlline{00125\ }\hlstd{simOut}\\
\mbox{}
\normalfont
