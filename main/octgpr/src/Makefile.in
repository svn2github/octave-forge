# Copyright (C) 2008  VZLU Prague, a.s., Czech Republic
# 
# Author: Jaroslav Hajek <highegg@gmail.com>
# 
# This file is part of OctGPR.
# 
# OctGPR is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this software; see the file COPYING.  If not, see
# <http://www.gnu.org/licenses/>.
# 

F77=@F77@
MKOCTFILE=@MKOCTFILE@
FFLAGS=@FFLAGS@ @FPICFLAG@
CC=@CC@ @CPICFLAG@
CFLAGS=@CFLAGS@ -I.
LIBS=@LIBS@

OBJS_GPR_TRAIN=dsdacc.o dwdis2.o dtr2tp.o corrf.o stheta.o \
	       nllgpr.o nldgpr.o nl0gpr.o pakgpr.o \
	       nllpgp.o nldpgp.o nl0pgp.o pakpgp.o \
	       dscrot.o dscsev.o dspmid.o dxnrm2.o \
	       dgesum.o dsumsq.o \
	       trstp.o sr1upd.o optdrv.o \
	       get_corrf.o train.o setup.o 
	       
OBJS_GPR_PRED=dsdacc.o dwdis2.o infgpr.o infpgp.o corrf.o \
	      get_corrf.o predict.o 
	      
all: gpr_train.oct gpr_predict.oct pgp_train.oct pgp_predict.oct pdist2_mw.oct

%.o: %.f
	$(F77) $(FFLAGS) -c $<
%.o: %.c forsubs.h gprmod.h
	$(CC) $(CFLAGS) -c $<

# C++ files are preferably compiled with mkoctfile directly
gpr_train.o: gpr_train.cc gprmod.h forsubs.h
	$(MKOCTFILE) -c $<
pgp_train.o: pgp_train.cc gprmod.h forsubs.h
	$(MKOCTFILE) -c $<
gpr_predict.o: gpr_predict.cc gprmod.h forsubs.h
	$(MKOCTFILE) -c $<
pgp_predict.o: pgp_predict.cc gprmod.h forsubs.h
	$(MKOCTFILE) -c $<

gpr_train.oct: gpr_train.o $(OBJS_GPR_TRAIN)
	$(MKOCTFILE) -o $@ gpr_train.o $(OBJS_GPR_TRAIN) $(LIBS)
gpr_predict.oct: gpr_predict.o $(OBJS_GPR_PRED) 
	$(MKOCTFILE) -o $@ gpr_predict.o $(OBJS_GPR_PRED) $(LIBS)

pgp_train.oct: pgp_train.o $(OBJS_GPR_TRAIN)
	$(MKOCTFILE) -o $@ pgp_train.o $(OBJS_GPR_TRAIN) $(LIBS)
pgp_predict.oct: pgp_predict.o $(OBJS_GPR_PRED) 
	$(MKOCTFILE) -o $@ pgp_predict.o $(OBJS_GPR_PRED) $(LIBS)

pdist2_mw.oct: pdist2_mw.cc
	$(MKOCTFILE) -o $@ $<

clean:
	rm -f *.o *.oct
distclean: clean
	rm -f config.h Makefile config.log config.status 

