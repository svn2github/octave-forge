scintilla: local makefile patches

diff -r 94270f95b9c2 scintilla/win32/makefile
--- a/scintilla/win32/makefile	Mon Apr 06 08:33:33 2009 +0200
+++ b/scintilla/win32/makefile	Tue May 12 10:01:18 2009 +0200
@@ -6,47 +6,44 @@
 # The -fvtable-thunks option is required for older (2.9*) versions of gcc but can be removed
 # safely if using a newer version which may display warning messages.
 
+SRCDIR=@SRCDIR@
+
 .SUFFIXES: .cxx
-CC = g++
 DLLWRAP = dllwrap
-DEL = del /q
+DEL = rm -rf
 
 COMPONENT = ../bin/Scintilla.dll
 LEXCOMPONENT = ../bin/SciLexer.dll
-LEXLIB = Lexers.a
+LEXLIB = ../lib/Lexers.a
 
-ifndef NOTHUNKS
-gversion = $(word 1,$(subst ., ,$(shell g++ --version)))
-ifeq ($(gversion),2)
-THUNKFLAGS=-fvtable-thunks
-endif
-endif
+vpath %.h $(SRCDIR)/src $(SRCDIR)/include $(SRCDIR)/win32
+vpath %.cxx $(SRCDIR)/src $(SRCDIR)/win32
+vpath %.rc  $(SRCDIR)/src $(SRCDIR)/win32
+vpath %.def $(SRCDIR)/win32
 
-vpath %.h ../src ../include
-vpath %.cxx ../src
-
-LDFLAGS=-mwindows -lstdc++ -limm32 -lole32 -luuid -mno-cygwin
+LDFLAGS+=-mwindows -limm32 -lole32 -luuid 
 # Add -MMD to get dependencies
 #CXXFLAGS = -g -pg -pedantic -Os -fno-exceptions -fvtable-thunks -fno-rtti
-INCLUDEDIRS=-I ../include -I ../src
-CXXBASEFLAGS=-Wall -Wno-missing-braces -Wno-char-subscripts -pedantic $(INCLUDEDIRS) -Os -fno-exceptions $(THUNKFLAGS) -fno-rtti -mno-cygwin
+INCLUDEDIRS=-I $(SRCDIR)/include -I $(SRCDIR)/src
+CXXBASEFLAGS=-Wall $(INCLUDEDIRS) -O3
 
 ifdef DEBUG
-CXXFLAGS=-DDEBUG $(CXXBASEFLAGS)
+CXXFLAGS+=-DDEBUG $(CXXBASEFLAGS)
 else
-CXXFLAGS=-DNDEBUG $(CXXBASEFLAGS)
+CXXFLAGS+=-DNDEBUG $(CXXBASEFLAGS)
 endif
 
 .cxx.o:
 	$(CC) $(CXXFLAGS) -c $<
 
-ALL:	$(COMPONENT) $(LEXCOMPONENT) $(LEXLIB) ScintillaWinS.o WindowAccessor.o
+ALL:	deps $(COMPONENT) $(LEXCOMPONENT) $(LEXLIB) ScintillaWinS.o WindowAccessor.o
 
 clean:
 	$(DEL) *.exe *.o *.obj *.dll *.res *.map
 
 deps:
-	$(CC) -MM $(CXXFLAGS) *.cxx ../src/*.cxx >deps.mak
+	$(CC) -MM $(CXXFLAGS) $(SRCDIR)/win32/*.cxx $(SRCDIR)/src/*.cxx | sed -e 's%\([a-z]\):[\\/]%/\1/%' -e 's+\\\([^^]\)+/\1+g' > deps.mak
+	touch deps
 
 #++Autogenerated -- run src/LexGen.py to regenerate
 #**LEXOBJS=\\\n\(\*.o \)
@@ -69,7 +66,7 @@
 	ScintRes.o PlatWin.o PositionCache.o KeyMap.o Indicator.o LineMarker.o RESearch.o RunStyles.o \
 	Style.o ViewStyle.o AutoComplete.o UniConversion.o PropSet.o XPM.o
 $(COMPONENT): $(SOBJS) Scintilla.def
-	$(DLLWRAP) --add-stdcall-alias --target i386-mingw32 -o $@ $(SOBJS) $(LDFLAGS) -s --relocatable
+	$(DLLWRAP) --driver-name=$(CXX) -def $(SRCDIR)/win32/Scintilla.def --add-stdcall-alias --target i386-mingw32 -o $@ $(SOBJS) $(CXXLIBS) $(LDFLAGS) -s --relocatable
 
 LOBJS	= ScintillaWinL.o ScintillaBaseL.o Editor.o CharClassify.o Decoration.o \
 	Document.o ContractionState.o CellBuffer.o CallTip.o \
@@ -77,7 +74,7 @@
 	Style.o ViewStyle.o AutoComplete.o UniConversion.o KeyWords.o \
 	DocumentAccessor.o PropSet.o ExternalLexer.o StyleContext.o XPM.o $(LEXOBJS)
 $(LEXCOMPONENT): $(LOBJS) Scintilla.def
-	$(DLLWRAP) --add-stdcall-alias --target i386-mingw32 -o $@ $(LOBJS) $(LDFLAGS) -s --relocatable
+	$(DLLWRAP) --driver-name=$(CXX) -def $(SRCDIR)/win32/Scintilla.def --add-stdcall-alias --target i386-mingw32 -o $@ $(LOBJS) $(CXXLIBS) $(LDFLAGS) -s --relocatable
 
 $(LEXLIB): $(LEXOBJS)
 	$(AR) rc $@ $^
@@ -112,6 +109,6 @@
 	$(CC) $(CXXFLAGS) -D SCI_LEXER -c $< -o $@
 
 ScintRes.o:	ScintRes.rc PlatformRes.h
-	windres ScintRes.rc $@
+	windres --preprocessor=$(CPP) $< $@
 
 
