diff -urN -x '*.exe' -x '*.dll' -x '*.o' -x '*.a' -x '*.bak' GraphicsMagick-1.3.3-orig/Magick++/bin/GraphicsMagick++-config.in GraphicsMagick-1.3.3/Magick++/bin/GraphicsMagick++-config.in
--- GraphicsMagick-1.3.3-orig/Magick++/bin/GraphicsMagick++-config.in	2008-05-05 04:32:49 +0200
+++ GraphicsMagick-1.3.3/Magick++/bin/GraphicsMagick++-config.in	2009-01-02 13:34:54 +0100
@@ -18,25 +18,35 @@
       exit 1
 fi
 
+buildprefix="@PREFIX_DIR@"
+
+# adapt prefix to installation directory
+selfdir=`dirname $0`
+if [ `basename ${selfdir}` = "bin" ]; then
+   prefix=`dirname ${selfdir}`
+else
+   prefix=${selfdir}
+fi
+
 while test $# -gt 0; do
   case $1 in
     --prefix)
-      echo @PREFIX_DIR@
+      echo ${prefix}
       ;;
     --exec-prefix)
-      echo @EXEC_PREFIX_DIR@
+      echo ${prefix}
       ;;
     --version)
       echo @PACKAGE_VERSION@
       ;;
     --cppflags)
-      echo '@MAGICK_API_CPPFLAGS@'
+      echo '@MAGICK_API_CPPFLAGS@' | sed -e "s%${buildprefix}%${prefix}%g"
       ;;
     --cxxflags)
-      echo '@CXXFLAGS@'
+      echo '@CXXFLAGS@' | sed -e "s%${buildprefix}%${prefix}%g"
       ;;
     --ldflags)
-      echo '@MAGICK_API_LDFLAGS@'
+      echo '@MAGICK_API_LDFLAGS@' | sed -e "s%${buildprefix}%${prefix}%g"
       ;;
     --libs)
       echo '-lGraphicsMagick++ @MAGICK_API_LIBS@'
diff -urN -x '*.exe' -x '*.dll' -x '*.o' -x '*.a' -x '*.bak' GraphicsMagick-1.3.3-orig/Makefile.in GraphicsMagick-1.3.3/Makefile.in
--- GraphicsMagick-1.3.3-orig/Makefile.in	2008-12-09 00:22:56 +0100
+++ GraphicsMagick-1.3.3/Makefile.in	2008-12-28 11:04:52 +0100
@@ -3094,7 +3094,7 @@
 filters_analyze_la_LDFLAGS = $(MODULECOMMONFLAGS)
 filters_analyze_la_LIBADD = $(LIBMAGICK)
 @WITH_MAGICK_PLUS_PLUS_FALSE@LIBMAGICKPP = 
-@WITH_MAGICK_PLUS_PLUS_TRUE@LIBMAGICKPP = Magick++/lib/libGraphicsMagick++.la
+@WITH_MAGICK_PLUS_PLUS_TRUE@LIBMAGICKPP = Magick++/lib/libGraphicsMagick++.la Magick++/lib/GraphicsMagick++.dll
 @WITH_MAGICK_PLUS_PLUS_FALSE@MAGICKPP_CHECK_PGRMS = 
 @WITH_MAGICK_PLUS_PLUS_TRUE@MAGICKPP_CHECK_PGRMS = $(MAGICKPP_CHECK_PGRMS_OPT)
 @WITH_MAGICK_PLUS_PLUS_FALSE@MAGICKPP_MANS = 
@@ -4977,6 +4977,17 @@
 	Magick++/lib/$(DEPDIR)/$(am__dirstamp)
 Magick++/lib/libGraphicsMagick++.la: $(Magick___lib_libGraphicsMagick___la_OBJECTS) $(Magick___lib_libGraphicsMagick___la_DEPENDENCIES) Magick++/lib/$(am__dirstamp)
 	$(Magick___lib_libGraphicsMagick___la_LINK) $(am_Magick___lib_libGraphicsMagick___la_rpath) $(Magick___lib_libGraphicsMagick___la_OBJECTS) $(Magick___lib_libGraphicsMagick___la_LIBADD) $(LIBS)
+Magick++/lib/GraphicsMagick++.dll : Magick++/lib/.libs/libGraphicsMagick++.a
+	$(CXX) -shared -o $@ \
+		$(LDFLAGS) \
+		-Wl,--out-implib=Magick++/lib/libGraphicsMagick++.dll.a \
+		-Wl,--output-def=Magick++/lib/libGraphicsMagick++.def \
+		-Wl,--whole-archive $< \
+		-Wl,--no-whole-archive \
+		-L./magick/.libs \
+		-lGraphicsMagick \
+		$(CXXLIBS) \
+		$(LIBS)
 coders/$(am__dirstamp):
 	@$(MKDIR_P) coders
 	@: > coders/$(am__dirstamp)
